<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="a playable turntable of tracks i love. screw with the tempo for the classic bevvy experience." />
  <meta property="og:title" content="bevvy's vinyl collection" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="a playable turntable of tracks i love." />
  <title>bevvy's vinyl collection</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <style>
    :root {
      --bg: #292C30;
      --ink: #414447;
      --accent: rgb(31, 124, 39);
      --barW: clamp(220px, 40vw, 360px);
      --edgeGap: 6px;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", Arial, sans-serif;
      color-scheme: dark;
      scrollbar-gutter: stable both-edges;
      overscroll-behavior: contain;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr;
    }

    header h1 {
      font-size: 20px;
      margin: 0 0 4px 0;
      letter-spacing: 0.5px;
      text-transform: lowercase;
      color: #fff;
    }

    header p {
      margin: 0;
      color: #aaa;
      font-size: 13px;
    }

    .deck{
      display:grid;
      grid-template-columns: clamp(180px,22vw,260px) 1fr clamp(180px,22vw,260px);
      gap:12px;
      align-items:start;
    }
    .side summary{
      position:relative; padding:8px 28px 8px 10px; margin:0;
      font-size:14px; font-weight:600; color:#fff; cursor:pointer;
      background:#24272b; border-bottom:1px solid #333; list-style: none;
    }
    .side summary::after{
      content:"‚ñæ"; position:absolute; right:8px; top:50%;
      transform: translateY(-50%) rotate(-90deg); transition: transform .18s ease-out, opacity .18s;
      opacity:.9;
    }
    .side details[open] summary::after{ transform: translateY(-50%) rotate(0deg); }

    .stage {
      display: grid;
      place-items: center;
      padding: 12px;
      background: #1b251b;
      background-image:
        radial-gradient(circle at center, rgba(255,255,255,0.03) 0, transparent 100%),
        url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.4' numOctaves='3'/></filter><rect width='800' height='800' filter='url(%23n)'/></svg>");
      background-size: 800px 800px;
      background-blend-mode: overlay;
      border: 1px solid #333;
      box-shadow: 0 2px 12px rgba(0,0,0,.3);
      position: relative;
    }

    .table-wrap{
      position: relative;
      display: inline-block;
      touch-action: pan-y pinch-zoom;
      overscroll-behavior: contain;
    }

    .table-wrap.dragging{
      touch-action: none;
    }

    .turntable {
      position: relative;
      width: min(72vmin, 540px);
      aspect-ratio: 1/1;
      display: grid;
      place-items: center;
      border-radius: 50%;
      overflow: hidden;
      background: radial-gradient(circle at 50% 50%, #111 0 69%, #000 52% 100%);
      border: 6px solid #1E1F23;
      box-shadow: inset 0 0 0 2px #000;
      contain: paint;
      backface-visibility: hidden; transform-origin: 50% 50%;
    }
    .platter{
      position:absolute;
      inset:0;
      border-radius:50%;
      will-change:transform;
      backface-visibility:hidden;
    }

    .tonearm{
      position: absolute;
      inset: 0;
      z-index: 3;
    }

    #arm {
      -webkit-user-select: none;
      user-select: none;
      pointer-events: auto;
      cursor: grab;
    }

    .turntable.playing { will-change: transform; }

    .turntable::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: repeating-radial-gradient(circle, rgba(255,255,255,0.025) 0 2px, transparent 2px 4px);
      pointer-events: none;
    }

    .label{
      position:absolute;
      width:48%;
      aspect-ratio:1/1;
      top:50%; left:50%;
      transform: translate(-50%,-50%);
      border-radius:50%;
      overflow:hidden;
      box-shadow:0 0 0 4px #111;
      display:grid; place-items:center;
      background:#000;
      backface-visibility:hidden; transform-origin:50% 50%;
    }

    .label img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .spindle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #999;
      box-shadow: inset 0 0 0 2px #666;
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      background: #1e1f23;
      border: 1px solid #333;
      padding: 16px;
      color: #eee;
    }

    .row { display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap; }
    .control-row{
      display: grid;
      grid-template-columns: 1fr minmax(0, var(--barW)) 1fr;
      align-items: center;
    }
    .grow { flex: 1 1 320px; min-width: 200px; }
    .loadflag{margin-left:6px;color:#aaa;font-style:italic;opacity:.9}
    .loadflag.hidden{display:none}

    button:hover, .toggle:hover { background: #3a3d42; }
    .toggle[aria-pressed="true"] {
      border-color: var(--accent);
      box-shadow: inset 0 0 0 2px color-mix(in oklab, var(--accent) 50%, black);
    }

    input[type="range"] { height: 6px; }
    .bar { width: 100%; }

    .control-row > :first-child{
      justify-self:end;
      text-align:right;
      white-space:nowrap;
      padding-right:var(--edgeGap);
      box-sizing:border-box;
    }
    .control-row > :last-child{
      justify-self:start;
      text-align:left;
      white-space:nowrap;
      padding-left:var(--edgeGap);
      box-sizing:border-box;
    }

    .meta { font-size: 14px; color: #ccc; text-align: center;}
    .meta b { font-weight: 600; color: #fff; }

    .blurb{
      text-align: center;
      font-size: 13px;
      color: #aaa;
      max-width: min(74ch, 92%);
      margin-inline: auto;
      line-height: 1.55;
    }
    .blurb em, .blurb i { color:#ccc; font-style: italic; }
    .blurb b, .blurb strong { color:#fff; font-weight:600; }
    .blurb.hidden{ display:none; }

    .time { font-variant-numeric: tabular-nums; color: #bbb; }

    footer { color: #777; font-size: 12px; text-align: center; padding: 8px 0 18px; line-height: 1.6; }

    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .section { background: #1e1f23; border: 1px solid #333; padding: 16px; color: #ccc; }
    .section h2 { margin: 0 0 8px 0; font-size: 16px; font-weight: 600; text-transform: lowercase; color: #fff; }
    .about p { margin: 0 0 8px 0; color: #ccc; }
    .about ul { margin: 0; padding-left: 18px; color: #aaa; }
    .about li { margin: 4px 0; }
    .favorites { content-visibility: auto; contain-intrinsic-size: 700px 900px; }
    .favorites p { margin: 0; color: #aaa; font-size: 13px; padding-bottom: 12px }

    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; }
    .gallery a { display: block; border: 1px solid #333; background: #2a2d31; padding: 6px; }
    .gallery img { width: 100%; height: 120px; object-fit: cover; display: block; }

    .tags {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      margin-top: 12px;
    }
    .tags span {
      background: #2a2d31;
      border: 1px solid #444;
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 13px;
      color: #ccc;
    }

    .plist{ display:flex; flex-direction:column; gap:6px; }
    .plist button{
      width:100%; text-align:left;
      background:#2a2d31; border:1px solid #333; padding:8px;
      font-size:13px; color:#ccc; cursor:pointer;
    }
    .plist button:hover{ background:#33373b; }
    .plist button[aria-current="true"]{ border-color:var(--accent); color:#fff;  }
    .plist strong { font-weight: 700; color: #fff; }
    .plist .artist { opacity: .8; }
    #notes details{ display:flex; flex-direction:column; }
    #notepad {
      box-sizing: border-box;
      height: calc(var(--stageH, 0px) - var(--notesHead, 40px));
      width: 100%;
      min-height: 220px;
      resize: none;
      background: #2a2d31;
      color: #ddd;
      border: 1px solid #333;
      padding: 10px;
      font: 13px/1.4 inherit;
    }

    #playlist .plist{ overflow: auto; max-height: calc(var(--stageH, 0px) - 40px); }

    #speedVal {
      cursor: pointer;
      user-select: none;
    }
    #speedVal:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
      border-radius: 4px;
    }

    .side{ padding:0; box-sizing:border-box; border:1px solid #333; }
    .side details{ display:flex; flex-direction:column; height:100%; background:transparent; }
    .side details[open]{ background:#1e1f23; }
    .side details:not([open]) > *:not(summary){ display:none; }
    .side details{ padding:12px; box-sizing:border-box; }
    .side summary{ margin:-12px -12px 12px; }
    .side details:not([open]) { padding: 0; }
    .side details:not([open]) > summary { margin: 0; }

    button, .toggle {
      appearance: none;
      border: 1px solid #555;
      background: #2f3237;
      color: #eee;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover, .toggle:hover { background: #3a3d42; }

    input[type="range"]{
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
      box-sizing: border-box;
      border: 1px solid #555;
      background: #2f3237;
      color: #eee;
      padding: 8px 0;
      height: 6px;
      display: block;
      width: 100%;
    }

    input[type="range"]::-webkit-slider-thumb,
    input[type="range"]::-moz-range-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px; height: 16px;
      border-radius: 20%;
      background: linear-gradient(145deg, #f0f0f0, #ccc);
      cursor: grab;
      border: 1px solid #444;
      box-shadow:
        0 2px 4px rgba(0,0,0,.4),
        inset 0 1px 1px rgba(255,255,255,.3);
    }
    input[type="range"]:active::-webkit-slider-thumb,
    input[type="range"]:focus::-webkit-slider-thumb,
    input[type="range"]:active::-moz-range-thumb,
    input[type="range"]:focus::-moz-range-thumb {
      border: 2px solid var(--accent);
      cursor: grabbing;
    }

    @media (min-width:901px){
      #playlist, #notes { height: var(--stageH); }
      .side summary { cursor: default; pointer-events:none; }
      .side summary::after{ content:none; }
    }
    @media (max-width:900px){
      #playlist, #notes { height:auto; }
      .wrap{ max-width: 860px; }
      .deck{ grid-template-columns:1fr; }
    }

    @media (max-width: 520px){
      .control-row{
        grid-template-columns: 1fr;
        grid-template-areas:
          "left"
          "bar"
          "right";
        row-gap: 6px;
      }
      .control-row > :first-child{
        grid-area: left;
        justify-self: center;
        padding-right: 0;
        text-align: center;
      }
      .control-row .bar{
        grid-area: bar;
        width: 100%;
        box-sizing: border-box;
      }
      .control-row > :last-child{
        grid-area: right;
        justify-self: center;
        padding-left: 0;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>bevvy's vinyl collection</h1>
      <p>just hit play and screw with the tempo for the classic bevvy experience!</p>
      <p>compelling auditory experiences may vary with tempo. your satisfaction is uncertain.</p>
    </header>

    <noscript>
      <div style="
        background:#1e1f23;
        border:1px solid #333;
        color:#eee;
        padding:16px;
        margin:12px 0;
        text-align:center;
        font-size:14px;
      ">
        ‚ö° this record needs electricity (please enable javascript).
      </div>
    </noscript>

    <section class="deck">
      <aside class="section side" id="playlist">
        <details id="pld" open>
          <summary>playlist</summary>
          <div id="playlist-list" class="plist"></div>
        </details>
      </aside>

      <main class="stage">
        <div class="table-wrap">
          <div class="turntable" id="turntable" aria-live="polite">
            <div class="platter">
              <div class="label"><img id="art" alt="album art" src="" /></div>
              <div class="spindle" aria-hidden="true"></div>
            </div>
          </div>
          <svg class="tonearm" viewBox="0 0 200 200" aria-hidden="true">
            <defs>
              <filter id="armShadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity=".3"/>
              </filter>
            </defs>
            <g id="armPivot" transform="translate(180,20)">
              <circle r="10" cx="0" cy="0" fill="#0f1013" stroke="#222"/>
              <g id="arm" style="transform-origin: 0px 0px;" filter="url(#armShadow)">
                <circle r="4" cx="0" cy="0" fill="#bfbfbf"/>
                <rect x="0" y="-2" width="120" height="4" rx="2" fill="#bfbfbf"/>
                <circle cx="136" cy="0" r="2.4" fill="#eaeaea" stroke="#888"/>
                <rect x="118" y="-6" width="18" height="12" rx="2" fill="#d9d9d9" stroke="#999"/>
              </g>
            </g>
          </svg>
        </div>
      </main>

      <aside class="section side" id="notes">
        <details id="noted" open>
          <summary>notes</summary>
          <textarea id="notepad" spellcheck="false" placeholder="jot something down..."></textarea>
        </details>
      </aside>
    </section>

    <section class="controls">
      <div class="row buttons-row">
        <button id="prev" aria-label="previous track">‚üµ prev</button>
        <button id="play" aria-label="play or pause">‚ñ∫ play</button>
        <button id="next" aria-label="next track">next ‚ü∂</button>
        <button id="shuffle" class="toggle" aria-pressed="false" aria-label="shuffle">shuffle</button>
        <button id="repeat" class="toggle" aria-pressed="false" aria-label="repeat">repeat: off</button>
        <button id="pitch" class="toggle" aria-pressed="false" aria-label="preserve pitch">preserve pitch</button>
        <button id="share" aria-label="share current track">share</button>
      </div>

      <div class="row control-row">
        <label for="volume">volume</label>
        <input id="volume" class="bar" type="range" min="0" max="1" step="0.01" value="1" />
        <span id="volVal">100%</span>
      </div>

      <div class="row control-row">
        <label for="speed">speed</label>
        <input id="speed" class="bar" type="range" min="0.25" max="2" step="0.01" value="1" />
        <span id="speedVal">1.00√ó</span>
      </div>

      <div class="row control-row">
        <label for="seek">progress</label>
        <input id="seek" class="bar" type="range" min="0" max="0" step="0.1" value="0" disabled />
        <span class="time"><span id="tCur">0:00</span> / <span id="tDur">--:--</span></span>
      </div>

      <div class="meta" id="meta" role="status" aria-live="polite" aria-atomic="true">no track loaded.</div>

      <div id="blurb" class="blurb" aria-live="polite"></div>

      <audio id="audio" preload="none" crossorigin="anonymous"></audio>
    </section>

    <section class="section about" id="about">
      <h2>about me</h2>
      <p id="about-text">i make bleeps and bloops. this page is a toy.</p>
      <div id="about-tags" class="tags"></div>
    </section>

    <section class="section favorites" id="favorites">
      <h2>favorite pictures</h2>
      <p>click for full</p>
      <div class="gallery" id="fav-gallery"></div>
    </section>

    <footer>
      audio re-encoded from 320kbps ogg to 96kbps opus with ‚ô•
      <br>
      est. 2025<span id="year"></span>
    </footer>
  </div>

  <script>
    (function() {
      const start = 2025;
      const now = new Date().getFullYear();
      if (now > start) { document.getElementById('year').textContent = '‚Äì' + now; }

      const BASE = 'https://cdn.jsdelivr.net/gh/calibancode/vinyl-media@7b93d4006ef14405c1b23cb103ff295ae87f46f6/';
      const A = (f) => BASE + 'audio/' + f;
      const IMG = (f) => BASE + 'art/' + f;
      const FAV = (f) => BASE + 'fav/' + f;

      const tracks = [
        { title: "Shadow", artist: "Ernst Reijseger", src: A("shadow.opus"), art: IMG("shadow.webp"), blurb: "this song was sent to me by a friend who goes by kazimir. i don't think there was any context to it other than it sounding like a dying whale's journey through the light towards the other side. it's great. turns out it was made for a documentary about ancient humans called 'cave of forgotten dreams'. haven't seen it, but i have listened to the whole soundtrack and each one is a certified avant-banger." },
        { title: "Pagan Poetry", artist: "Bj√∂rk", src: A("pagan-poetry.opus"), art: IMG("pagan-poetry.webp"), blurb: "i've liked bj√∂rk long enough that i can't pin down what song really made her stick with me, but i like this one in particular for being all around bj√∂rky goodness. look up the video of her fawning over a television, and then the one of her attacking a reporter." },
        { title: "Rats", artist: "Joy Again", src: A("rats.opus"), art: IMG("rats.webp"), blurb: "joy again was one of the few spotify algorithm drops that i actually enjoyed, let alone adored. despite listening to this song hundreds of times, i still can't really pin down what the fuck it means. it's like my version of seal's kiss from a rose. trying to understand what's happening isn't the point. that sick ass tune is the point. their other music is also good. the album this is from is called 'piano', and the art for it was a big push for me to make the album covers here visible. say 'thank you, rats'" },
        { title: "Black", artist: "Toby 'Radiation' Fox", src: A("black.opus"), art: IMG("black.webp"), blurb: "toby fox's 'black' is a song that needs no introduction. unless, of course, you aren't a terminally online young adult who grew up being read one of the most assinine webcomics in existence by your big siblings. this ear worm is, in a way, the 'theme' of bec noir's ascension to power, one of the major antagonists of homestuck with about as complex of moral reasoning as any other antagonist in homestuck. he's easily annoyed, and the answer to all his problems is, naturally, murder."},
        { title: "All Dead, All Dead", artist: "Queen", src: A("all-dead-all-dead.opus"), art: IMG("all-dead-all-dead.webp"), blurb: "one of my favorite songs from my favorite queen album. this one definitely shouldn't need any introduction. if you don't know who queen is, you're lying. if you know who queen is but haven't listened to their album 'news of the world', you should rectify that. this song is about brian may's late cat, believe it or not. that makes it sadder for me."},
        { title: "Equilibrium", artist: "Masayoshi Soken", src: A("equilibrium.opus"), art: IMG("equilibrium.webp"), blurb: "it was challenging to pick one raid song from ffxiv to share here. video game music doesn't usually have orchestral effort put into it, but soken goes unbelievably hard in a lot of the music made for this game. equilibrium just goes especially hard. i don't think you need to play ffxiv (and you probably shouldn't) in order to enjoy the breadth of music on display across it's expansions. soken is that much of a genius. i don't think he's phoned it in even once. even the goofiest tracks he's made for fourteen have soul you can't deny."},
        { title: "Fall Again (Demo)", artist: "Michael Jackson", src: A("fall-again.opus"), art: IMG("fall-again.webp"), blurb: "here's my pretentiously obscure mj pick for the setlist chosen entirely for exposure's sake, not because i necessarily sit down every morning and jerk off to the tear-wrenching heights of michael's weirdly precognizant lyrics. it's a good song, and it goes to show that the legend can be more than the thriller, though sometimes that never panned out. this demo track only surfaced in a box set for the mj ultimate collection in 2004, despite being recorded back in `99. rumor goes that life happened. sucks. you can't find this on streaming services, so i thought it'd be a neat addition." },
        { title: "Blue Lips", artist: "Regina Spektor", src: A("blue-lips.opus"), art: IMG("blue-lips.webp"), blurb: "blue lips was the first regina spektor song i ever heard, and i'm pretty sure it was a part of a homestuck animatic of some kind that i can't be arsed to look up, because regina's music went way beyond that little exposure moment for me. she became a favorite of mine as soon as i dove into her other albums. blue lips is nice, but it's nothing compared to the rest of her discography. regina is one of the few artists i've bothered to see live, and it was a unforgettable show. she was sick when she performed for us, hoarse voice and all that, but she sang so beautifully that you wouldn't have been able to tell, even despite having mentioned it. she played her best hits and some obscure ones, and even played us a demo she never intended to release because it was about how much she hated her neighbor or some shit. i love this lady to bits, and if there were any artist in this setlist i wholeheartedly suggest you check out, it would easily be regina spektor." },
        { title: "Goliath", artist: "Woodkid", src: A("goliath.opus"), art: IMG("goliath.webp"), blurb: "while this wasn't the first song i heard from woodkid (that would be 'so handsome hello'), it was by far the most impactful. it's one of the few tunes on this list impressive enough that even my music stingy partner can't help but adore. it hails from the album s16, woodkid's exploration into the human condition, our relationship with consumerism, and the destruction of the environment. it's a harsh album, very orchestral, and quite depressing, but damn is it fantastic. i probably would have put multiple songs from this album alone on this list if i wasn't trying to avoid bloating it unnecessarily. if there were one album on this setlist that i'd wholeheartedly suggest you check out, it would have to be s16."},
        { title: "Abbey", artist: "Mitski", src: A("abbey.opus"), art: IMG("abbey.webp"), blurb: "i can't claim to know what mitski's deal is since half her discography is about relationship loss, but i just hope she's doing alright. abbey is a prime example while not being so literally on the nose about it. apparently the fandom culture around her is incredibly toxic, but i don't have any first person experience with it. maybe, if you meet mitski on the street, don't grab and shake her like a bop-it."},
        { title: "1984 (Ë•øÊö¶2000Âπ¥„Å´Âêë„Åë„Å¶)", artist: "Junko Yagami", src: A("1984.opus"), art: IMG("1984.webp"), blurb: "junko yagami's communication is an album from 1985 that, as i understand it, never saw that much critical acclaim. it was introduced to me by a friend who goes by exaccghost (they're also on neocities!) under circumstances i can't remember. it's a bop, that's all that matters. i highly recommend checking out the album since basically every song has something good to give. not into city pop? you're wrong. take an aspirin and try again." },
        { title: "Bones", artist: "Low Roar", src: A("bones.opus"), art: IMG("bones.webp"), blurb: "bones is one of the earlier songs that features in death stranding, kojima's parcel master babysitting simulator and my favorite video game of all time. it plays during an eight hour portion of the game that i'd consider the 'tutorial', where you're strapped for resources, vehicles, knowledge, and ability but forced to trudge through a post-apocalyptic wasteland because no one else will. when you feel like everything is lost and nothing matters, this game manages to sprinkle you with just enough hope to keep going in the form of tracks left by other players and downright banging music choices by kojimbo himself that play at just the right time. this addition is really more of a love letter to death stranding than it is to low roar. still, it's at least worth mentioning that low roar was a project of ryan karazija who passed in 2022. the project is a surviving and highly emotional element of him that's worth looking into." },
        { title: "Latin Simone", artist: "Gorillaz", src: A("latin-simone.opus"), art: IMG("latin-simone.webp"), blurb: "the g-sides version of latin simone is a lot more melancholy than its gorillaz debut album counterpart with vocals by ibrahim ferrer. the original english version feat. damon albarn, which i'm hosting here, feels more like a lonely downward spiral than a comforting friend. oddly enough, this track isn't even present on the european and japanese version of g-sides, so a lot of fans likely aren't even aware of its existence. i find that neat!" },
        { title: "Dark Red", artist: "Steve Lacy", src: A("dark-red.opus"), art: IMG("dark-red.webp"), blurb: "this is my suburban white boy pick. it's chill, groovy, and i listened to it way too many times while on my 30 minute drive to and from school every day as a teen. it's the only steve lacy song i know, too. i'd be called a fake fan if i ever claimed to be a fan, so i'm not gonna do that. i'm just a fan of this song in particular."},
        { title: "Ghosting", artist: "Mother Mother", src: A("ghosting.opus"), art: IMG("ghosting.webp"), blurb: "if you ever feel like you aren't good enough for your partner, at least you aren't dead. so, don't kill yourself! in all seriousness, mother mother is fairly well known and probably doesn't need much introduction. if you think you don't know them, look up 'hayloft' and i'm like 60% certain you'll say 'ohhh..' as for ghosting, i like it a lot more than hayloft, which is probably my, like.. top eight or nine in a twelve song album. i'm saying go listen to 'o my heart' in it's entirety." },
        { title: "Frozen Flame", artist: "Blank Banshee", src: A("frozen-flame.opus"), art: IMG("frozen-flame.webp"), blurb: "blank banshee is another recommendation from exaccghost which further proves their superior music taste to my own. they're the influential name in vaportrap. i don't think they've made a bad album, and this is just one nice song out of a whole discography of pretty unique music. at least, to my ears. maybe you hate this. maybe you hate me. that's your fault for making it this far and still thinking i have something coherent to offer you. everyone else can buckle up."},
        { title: "911 / Mr. Lonely (feat. Frank Ocean & Steve Lacy)", artist: "Tyler, The Creator", src: A("911.opus"), art: IMG("911.webp"), blurb: "dear diary, i'm 12 years old and this is deep. also, i lied earlier about only knowing one steve lacy song." },
        { title: "RADW", artist: "Haftbefehl", src: A("radw.opus"), art: IMG("radw.webp"), blurb: "this track was introduced to me by unitybirb, who probably thinks i'm gay for still listening to it rather than branching off into more interesting german rap territory. i don't speak german, but i do speak angst and bass. haftbefehl is apparently a really cool dude, despite rapping about drugs and gang activity like everyone else. if you like german rap at all, i'd recommend listening to more from him, but you probably already do. haftbefehl kind of reinvented the sound of the genre." },
        { title: "Wriggle", artist: "clipping.", src: A("wriggle.opus"), art: IMG("wriggle.webp"), blurb: "another artist introduced to me by unitybirb, firmly cementing them into a class above me in music taste. clipping was once described to me as sounding like 'the feeling you get when you drop your burnt toast buttered side down on the kitchen floor', and few songs in their discography convey that feeling better than wriggle."},
        { title: "Wolves", artist: "Kanye West", src: A("wolves.opus"), art: IMG("wolves.webp"), blurb: "this one definitely doesn't need an introduction. i can say that the life of pablo is one of my favorite kanye albums. this song in particular is fantastic. it even has sia! and, look, i know kanye isn't exactly kosher to associate with, and you'd be right if i cared."},
        { title: "DEAD FLOWERS", artist: "HEALTH, Poppy", src: A("dead-flowers.opus"), art: IMG("dead-flowers.webp"), blurb: "i'll admit it outright, this is my cheat song for getting two poppy songs in. but it's very good! health can make one hell of a dark, chunky beat which works way too well with poppy's angelic singing. i would love to see her live someday. more on poppy later." },
        { title: "Turn the Lights Off", artist: "Tally Hall", src: A("turn-the-lights-off.opus"), art: IMG("turn-the-lights-off.webp"), blurb: "this one is fun. not only was it my introduction to Tally Hall/Joe Hawley, but it was in the form of a frankly iconic fnaf animation by kibadoglover on youtube. just look up that artist's name and this song. honestly, there's a lot of other, better tally hall songs, but this one has a particularly special place in my heart for just how many god damn times i listened to it as a kid. obsession is a light word, and it's all kiba's fault."},
        { title: "Penelope Graves", artist: "Dirt Poor Robins", src: A("penelope-graves.opus"), art: IMG("penelope-graves.webp"), blurb: "this isn't the first dirt poor robins song i heard, that would be elanor rigby, but this one is an original. if you don't know dirt poor robins, they're a prog-rock band that blends orchestral, choral, and rock solos all in the same story albums. they're criminally underrated. you can find entire movies/stage plays they make to go along with their music on their youtube, and i recommend taking a look! you might just get lost in the sauce listening to 'babylon' and 'enchant√©' over and over again for hours at a time." },
        { title: "Cheval", artist: "Igorrr", src: A("cheval.opus"), art: IMG("cheval.webp"), blurb: "let me say this straight. IGORRR FUCKS. honestly, i have mad respect for any artist, like igorrr, who will hire extremely talented individuals to play out their mad artistic whims without trying to take themselves too seriously. the end results are always fascinating, and more often than not, absolute bangers. the range of noises igorrr will show you throughout his discography could probably fill a book, but most of it revolves around what i and many others would call 'baroquecore' in its classically inspired insanity."},
        { title: "Computers", artist: "clown core", src: A("computers.opus"), art: IMG("computers.webp"), blurb: "in a similar vein to igorrr with a more narrow scope exists clowncore. these guys really take the 'not taking ourselves too seriously' aspect of the game to a whole 'nother level. i beg of you to watch the video series that was released along with the album this song is from, 'van'. i don't want to get hasty, but i think it'll change you. for the better? maybe. maybe not. are you fucking weak?" },
        { title: "MURDER EVERY 1 U KNOW!", artist: "femtanyl", src: A("murder-every-1-u-know.opus"), art: IMG("murder-every-1-u-know.webp"), blurb: "stream chaser." },
        { title: "Absolute Territory", artist: "Ken Ashcorp", src: A("absolute-territory.opus"), art: IMG("absolute-territory.webp"), blurb: "ken ashcorp is like if cringe incarnate learned how to use fl studio. me and most other people first heard his track 20 percent cooler back in the height of the brony days, and the rest of us stayed with his dumb ass for absolute territory. his music can be.. irreverent. but god damn, can that man commit to the bit." },
        { title: "Cheerleader", artist: "Ashnikko", src: A("cheerleader.opus"), art: IMG("cheerleader.webp"), blurb: "ashnikko is like if billie eilish had the balls to actually scare men away with her music. it's loud, brash, feminist, a little bit horny, and it really makes my ears happy. she hasn't made a bad album yet and i doubt she's ever going to." },
        { title: "HAZARD DUTY PAY!", artist: "JPEGMAFIA", src: A("hazard-duty-pay.opus"), art: IMG("hazard-duty-pay.webp"), blurb: "another introduction at fault of unitybirb. i don't really know what jpegmafia's deal is, but he can seriously produce. and produce he does, all on his own, from studio to release. that's kind of his whole schtick, being a capital S solo artist, no labels, no baggage, just really good music that i can't personally relate to anything else i've heard." },
        { title: "Touch Grass", artist: "Dorian Electra", src: A("touch-grass.opus"), art: IMG("touch-grass.webp"), blurb: "yet another unitybirb excursion! dorian electra hit hard for me from the first time i heard 'flamboyant' and 'career boy'. if regina spektor is my favorite singer-songwriter, dorian electra is my favorite pop star. god, now i'm imagining them in the same room together. that's giving me an aneurysm." },
        { title: "Rock Bottom Again", artist: "Pigeon John", src: A("rock-bottom-again.opus"), art: IMG("rock-bottom-again.webp"), blurb: "pigeon john is a weird one. he's mostly (almost exclusively) known for 'the bomb', which famously played in the 2014 e3 trailer for dead island 2 and in just about every single one of fighter pl's dark souls 3 pvp videos. but, maybe surprisingly, pigeon john has a discography. and it's actually some pretty good stuff!" },
        { title: "DEUS EX MACHINA", artist: "labirhin", src: A("deus-ex-machina.opus"), art: IMG("deus-ex-machina.webp"), blurb: "this is one of the newest songs on this playlist, and it's from a fantastic audio-visual artist from indonesia who goes by the handle labirhin. this song was composed to pair with the first episode of mau makan apa by the same name. the song is great, but the visuals and storytelling that are meant to go along with it really sell the experience in a way that i can't possibly hope to convey here. so.. go watch it already!"},
        { title: "The Holy Mountain", artist: "Poppy", src: A("the-holy-mountain.opus"), art: IMG("the-holy-mountain.webp"), blurb: "it's poppy! if you were around for her introduction as a strange meme figure but not for the subsequent musical career, you might be surprised to see the name again. hell, you probably forgot about the old meme, and that's probably for the best! i don't really know how to describe her other than giving me modern day david bowie vibes with her character driven music. i'm a big fan and i hope to see a lot more from her in the future."},
        { title: "CD Player, Pt. III", artist: "death's dynamic shroud", src: A("cd-player-pt-iii.opus"), art: IMG("cd-player-pt-iii.webp"), blurb: "another show-and-tell from exaccghost, and i distinctly remember first hearing these tunes in my absolutely bonkers tower unite house where we hung out for a few hours shooting the shit and listening to wacky beats. one such wacky beat comes from the musical ministrations of death's dynamic shroud, which i'm afraid to say i know woefully little about. what i do know is that this album, 'i'll try living like this', is widely considered to be a masterpiece in the vaporwave space. despite my middling understanding of the genre, i'd have to agree. the whole thing is a bop, through and through." },
        { title: "My Way", artist: "Frank Sinatra", src: A("my-way.opus"), art: IMG("my-way.webp"), blurb: "i'm italian. pizza gabagoolie salami calzone. frank sinatra hated this song, called it 'self serving and self indulgent'. seth macfarlane did a great rendition of this in the movie 'sing' where he plays as an asshole talking mouse." }
      ];

      const audio = document.getElementById('audio');
      const art = document.getElementById('art');
      const meta = document.getElementById('meta');
      const turntable = document.getElementById('turntable');
      const platter = document.querySelector('.platter');
      const playBtn = document.getElementById('play');
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');
      const shuffleBtn = document.getElementById('shuffle');
      const repeatBtn = document.getElementById('repeat');
      const pitchBtn = document.getElementById('pitch');
      const speed = document.getElementById('speed');
      const speedVal = document.getElementById('speedVal');
      const volume = document.getElementById('volume');
      const volVal = document.getElementById('volVal');
      const blurb = document.getElementById('blurb');
      const VOL_KEY = 'vinyl_volume';
      const MUTE_KEY = 'vinyl_muted';
      const PLAYBACK_KEY = 'vinyl_last_playback_v1';
      const RM_OVERRIDE_KEY = 'vinyl_rm_override';
      const RM_MQL = matchMedia?.('(prefers-reduced-motion: reduce)');
      const defaultTitle = "bevvy's vinyl collection";
      const STATE_SAVE_INTERVAL = 3000;
      const easeDur = 900;
      const ARM_BASE_DEG = 90;
      const ARM_MIN = 2;
      const ARM_MAX = 26;
      const ARM_REST = 0;
      const ARM_EASE_FAST = 240;
      const ARM_EASE_SEEK = 180;
      const ARM_FOLLOW_HZ = 10;
      const ARM_PLATTER_EPS = 0.6;
      const armEl = document.getElementById('arm');

      const GEO = (() => {
        const CX = 100, CY = 100;
        const PX = 180, PY = 20;
        const D = Math.hypot(PX - CX, PY - CY);
        const L = 136;
        const R_OUTER = 78;
        const R_INNER = 44;

        const clamp01 = (x) => Math.min(1, Math.max(0, x));
        const phiFromR = (r) => {
          const c = (D*D + L*L - r*r) / (2*D*L);
          const cc = Math.min(1, Math.max(-1, c));
          return Math.acos(cc) * 180/Math.PI; // deg
        };
        const rFromPhi = (phiDeg) => {
          const c = Math.cos(phiDeg * Math.PI/180);
          const r2 = D*D + L*L - 2*D*L*c;
          return Math.sqrt(Math.max(0, r2));
        };

        const PHI_OUT = phiFromR(R_OUTER);
        const PHI_IN  = phiFromR(R_INNER);

        const norm = (x,a,b) => (x - a) / (b - a);
        const lerp = (t,a,b) => a + t*(b - a);

        function pToDegGeom(p){
          const pp  = clamp01(p);
          const r   = R_OUTER - pp * (R_OUTER - R_INNER);
          const phi = phiFromR(r);
          const t   = norm(phi, PHI_OUT, PHI_IN);
          return lerp(t, ARM_MIN, ARM_MAX);
        }

        function degToPGeom(deg){
          const t   = norm(deg, ARM_MIN, ARM_MAX);
          const phi = lerp(t, PHI_OUT, PHI_IN);
          const r   = rFromPhi(phi);
          const p   = (R_OUTER - r) / (R_OUTER - R_INNER);
          return clamp01(p);
        }

        return { pToDegGeom, degToPGeom };
      })();

      const seek = document.getElementById('seek');
      const tCur = document.getElementById('tCur');
      const tDur = document.getElementById('tDur');

      let i = 0;
      let shuffle = false;
      let repeatMode = 'off';
      let angle = 0;
      let lastTime = null;
      let rate = 1;
      let animFrame;
      let seekDragging = false;
      let spinVel = 0;
      let easing = false;
      let easeStart = 0;
      let easeStartVel = 0;
      let autoAdvancing = false;
      let shuffleOrder = null;
      let shuffleCursor = 0;
      let lastStateSave = 0;
      let unlockSecret = false;
      let slugToIdx = Object.create(null);
      let idxToSlug = [];
      let pendingResume = null;
      let prePlaySeekP = null;
      let armCurDeg = ARM_REST;
      let armTargetDeg = ARM_REST;
      let armEaseFrom = ARM_REST;
      let armEaseStart = 0;
      let armEaseDur = 0;
      let armAnimating = false;
      let scrubbing = false;
      let altLayout = false;
      let allowMotion = sessionStorage.getItem(RM_OVERRIDE_KEY) === 'allow';

      const secretConfig = {
        keyPattern: [38,38,40,40,37,39,37,39,66,65],
        modeFlag: "altLayout",
        action: () => {
          console.log("‚ú® unlocking secret visuals...");
          unlockSecret = true;
        },
        validate(seq) {
          return JSON.stringify(seq) === JSON.stringify(this.keyPattern);
        }
      };

      function reducesMotion() {
        const ov = sessionStorage.getItem(RM_OVERRIDE_KEY);
        if (ov === 'force-on')  return true;
        if (ov === 'force-off') return false;
        return !!RM_MQL?.matches;
      }

      RM_MQL?.addEventListener?.('change', () => ensureRAF());
      window.addEventListener('storage', (e) => {
        if (e.key === RM_OVERRIDE_KEY) ensureRAF();
      });

      function slugifyTitle(str){
        return String(str || '')
          .toLowerCase()
          .normalize('NFKD')
          .replace(/[\u0300-\u036f]/g, '')
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/^-+|-+$/g, '')
          .replace(/-{2,}/g, '-');
      }

      function buildSlugIndex(){
        slugToIdx = Object.create(null);
        idxToSlug = [];

        const seen = Object.create(null);
        tracks.forEach((t, idx) => {
          const base = slugifyTitle(t.title);
          let slug = base || String(idx);
          if (seen[slug]) {
            let n = ++seen[slug];
            while (seen[`${base}-${n}`]) n++;
            slug = `${base}-${n}`;
            seen[slug] = 1;
          } else {
            seen[slug] = 1;
          }
          slugToIdx[slug] = idx;
          idxToSlug[idx] = slug;
        });
      }

      function setArmByProgress(p){
        if (!armEl || !isFinite(p)) return;
        armTargetDeg = GEO.pToDegGeom(p);
      }

      function setArmImmediateDeg(deg){
        armCurDeg = deg;
        armTargetDeg = deg;
        if (armEl) armEl.style.transform = `rotate(${ARM_BASE_DEG + deg}deg)`;
      }

      function easeArmToDeg(deg, dur = ARM_EASE_FAST){
        armEaseFrom  = armCurDeg;
        armTargetDeg = deg;
        armEaseStart = performance.now();
        armEaseDur   = Math.max(60, dur);
        armAnimating = true;
        ensureRAF();
      }

      function isOnPlatterDeg(deg){ return deg >= (ARM_MIN + ARM_PLATTER_EPS); }

      function progToDeg(p){ return GEO.pToDegGeom(p); }

      function consumeTrackParam(){
        const idx = getIdxFromQuery();
        if (idx < 0) return false;

        i = idx;
        load(i, false);

        if (shuffle && Array.isArray(shuffleOrder)) {
          const pos = shuffleOrder.indexOf(i);
          if (pos !== -1) shuffleCursor = pos;
        }

        try {
          const clean = location.pathname + (location.hash || '');
          history.replaceState(null, '', clean);
        } catch {}

        return true;
      }

      function getIdxFromQuery(){
        const params = new URLSearchParams(location.search);
        const q = params.get('track');
        if (!q) return -1;
        const slug = slugifyTitle(q);
        return slugToIdx[slug] ?? -1;
      }

      function getShareURL(){
        const slug = idxToSlug?.[i] || slugifyTitle(tracks[i]?.title) || String(i);
        const url  = new URL(location.href);
        url.search = `?track=${slug}`;
        return url.toString();
      }

      function setBlurb(txt){
        if (!blurb) return;
        blurb.textContent = txt || '';
        blurb.classList.toggle('hidden', !txt);
      }

      async function copyText(txt){
        try {
          await navigator.clipboard.writeText(txt);
          return true;
        } catch {
          const ta = document.createElement('textarea');
          ta.value = txt;
          ta.setAttribute('readonly', '');
          ta.style.position = 'fixed';
          ta.style.opacity = '0';
          document.body.appendChild(ta);
          ta.select();
          const ok = document.execCommand('copy');
          document.body.removeChild(ta);
          return ok;
        }
      }

      (function wireShare(){
        const btn = document.getElementById('share');
        if (!btn) return;

        btn.addEventListener('click', async () => {
          const url = getShareURL();

          if (navigator.share) {
            try {
              await navigator.share({ title: document.title, url });
              return;
            } catch {}
          }

          const ok = await copyText(url);

          const old = btn.textContent;
          btn.textContent = ok ? 'copied!' : 'copy failed';
          btn.setAttribute('aria-live', 'polite');
          setTimeout(() => { btn.textContent = old; }, 1200);
        });
      })();

      function swapArt(url){
        if (altLayout) url = FAV("scooter.webp");
        try { art.setAttribute('fetchpriority', 'high'); } catch {}
        try { art.loading = 'eager'; } catch {}
        try { art.decoding = 'async'; } catch {}
        art.src = url;
      }

      if (unlockSecret) {
        console.log("üêá down the rabbit hole...");
      }

      function setSource(track) {
        try { document.getElementById('preload-art')?.remove(); } catch {}
        try {
          const link = document.createElement('link');
          link.id = 'preload-art';
          link.rel = 'preload';
          link.as = 'image';
          link.href = track.art;
          link.fetchPriority = 'high';
          document.head.appendChild(link);
        } catch {}

        audio.preload = audio.paused ? 'none' : 'metadata';
        audio.src = track.src;
        swapArt(track.art);
        art.alt = `album art for ${track.title}`;
        meta.innerHTML = `<b>${track.title}</b> ‚Äì ${track.artist}`;
        setBlurb(track.blurb);
        setLoading(!audio.paused);

        seek.value = 0;
        seek.max = 0;
        seek.disabled = true;
        tCur.textContent = '0:00';
        tDur.textContent = '--:--';
        document.title = defaultTitle;
      }

      function resetPlatterAngle(){
        platter.classList.add('snap-reset');
        angle = 0;
        platter.style.transform = 'rotate(0deg)';
        platter.addEventListener('transitionend', () => {
          platter.classList.remove('snap-reset');
        }, { once:true });
      }

      function syncRepeatUI(btn) {
        if (!btn) return;
        btn.textContent = `repeat: ${repeatMode}`;
        btn.setAttribute('aria-pressed', String(repeatMode !== 'off'));
      }

      function cycleRepeat() {
        repeatMode = repeatMode === 'off' ? 'one' : repeatMode === 'one' ? 'all' : 'off';
        audio.loop = repeatMode === 'one';
        syncRepeatUI(document.getElementById('repeat'));
      }

      function fyShuffle(arr){
        for (let m = arr.length - 1; m > 0; m--){
          const j = Math.floor(Math.random() * (m + 1));
          [arr[m], arr[j]] = [arr[j], arr[m]];
        }
        return arr;
      }

      function buildShuffleOrder(currentIdx){
        const n = tracks.length;
        const rest = Array.from({length:n},(_,k)=>k).filter(k=>k!==currentIdx);
        fyShuffle(rest);
        return [currentIdx, ...rest];
      }

      function getVisibleOrder(){
        if (!shuffle || !shuffleOrder) {
          return Array.from({length: tracks.length}, (_, k) => k);
        }
        return shuffleOrder.slice();
      }

      function findInVisibleOrder(idx){
        const order = getVisibleOrder();
        return { order, pos: order.indexOf(idx) };
      }

      function setPreservePitch(yes){
        try {
          if ('preservesPitch' in audio) audio.preservesPitch = yes;
          if ('mozPreservesPitch' in audio) audio.mozPreservesPitch = yes;
          if ('webkitPreservesPitch' in audio) audio.webkitPreservesPitch =  yes;
        } catch(e) {}
      }

      function setRate(r){
        rate = Math.max(0.25, Math.min(2, Number(r)));
        audio.playbackRate = rate;
        if (speed) speed.value = String(rate);
        const txt = `${rate.toFixed(2)}√ó`;
        speedVal.textContent = txt;
        speed.setAttribute('aria-valuetext', txt);
      }

      function setVolume(v){
        const nv = Math.min(1, Math.max(0, Number(v)));
        audio.volume = nv;
        volume.value = String(nv);
        const txt = audio.muted ? 'muted' : Math.round(nv*100)+'%';
        volVal.textContent = txt;
        volume.setAttribute('aria-valuetext', txt);
        localStorage.setItem(VOL_KEY, String(nv));
      }
      function setMuted(on){
        audio.muted = !!on;
        volVal.textContent = on ? 'muted' : Math.round(audio.volume*100)+'%';
        sessionStorage.setItem(MUTE_KEY, on ? '1' : '0');
      }
      function bumpVolume(delta){
        if (audio.muted && delta > 0) setMuted(false);
        setVolume((audio.volume || 0) + delta);
      }

      function rpmToDegPerSec(rpm){ return (rpm * 360) / 60; }
      function currentDegPerSec(){ return rpmToDegPerSec(33.333 * rate); }

      function ensureRAF(){ if (!animFrame) animFrame = requestAnimationFrame(animateSpin); }
      function cancelRAF(){ if (animFrame) { cancelAnimationFrame(animFrame); animFrame = undefined; } }

      function startSpin(){
        easing = false;
        autoAdvancing = false;
        spinVel = currentDegPerSec();
        turntable.classList.add('playing');
        lastTime = null;
        ensureRAF();
      }

      function startEaseOut(){
        easing = true;
        autoAdvancing = false;
        easeStart = performance.now();
        easeStartVel = currentDegPerSec();
        ensureRAF();
      }

      function stopImmediate(){
        easing = false;
        autoAdvancing = false;
        spinVel = 0;
        turntable.classList.remove('playing');
        cancelRAF();
      }

      function playPause(){
        if (audio.paused) {
          if (prePlaySeekP == null && !isOnPlatterDeg(armCurDeg)) {
            easeArmToDeg(ARM_MIN, ARM_EASE_SEEK);
          }

          if (prePlaySeekP != null) {
            if (!(isFinite(audio.duration) && audio.duration > 0)) {
              audio.preload = 'metadata';
              const p = prePlaySeekP;
              prePlaySeekP = null;

              const applyAndPlay = () => {
                const d = audio.duration;
                if (isFinite(d) && d > 0) {
                  const t = clamp(d * p, 0, Math.max(0, d - 0.01));
                  audio.currentTime = t;
                  seek.value = t;
                  tCur.textContent = formatTime(t);
                  easeArmToDeg(progToDeg(p), ARM_EASE_FAST);
                }
                audio.play().then(()=>{ startSpin(); playBtn.textContent = '‚ùö‚ùö pause'; }).catch(()=>{});
                audio.removeEventListener('loadedmetadata', applyAndPlay);
              };

              audio.addEventListener('loadedmetadata', applyAndPlay);
              return;
            } else {
              const d = audio.duration;
              const t = clamp(d * prePlaySeekP, 0, Math.max(0, d - 0.01));
              prePlaySeekP = null;
              audio.currentTime = t;
              seek.value = t;
              tCur.textContent = formatTime(t);
              easeArmToDeg(progToDeg((audio.currentTime||0)/d), ARM_EASE_FAST);
            }
          }

          audio.preload = 'none';
          audio.play().then(()=>{ startSpin(); playBtn.textContent = '‚ùö‚ùö pause'; }).catch(()=>{});
        } else {
          audio.pause();
          playBtn.textContent = '‚ñ∫ play';
          document.title = defaultTitle;
        }
      }

      function animateSpin(ts) {
        animFrame = undefined;

        const rm = reducesMotion();

        if (ts === undefined) ts = performance.now();
        if (lastTime === null) lastTime = ts;
        const dt = (ts - lastTime) / 1000;
        lastTime = ts;

        if (rm) {
          spinVel = 0;
        } else if (!audio.paused && !easing) {
          spinVel = currentDegPerSec();
        } else if (autoAdvancing) {
          spinVel = currentDegPerSec();
        } else if (easing) {
          const t = Math.min(1, (ts - easeStart) / easeDur);
          const k = Math.pow(1 - t, 3);
          spinVel = easeStartVel * k;
          if (t >= 1 || spinVel < 0.1) { spinVel = 0; easing = false; turntable.classList.remove('playing'); }
        } else {
          spinVel = 0;
        }

        if (spinVel > 0) {
          angle = (angle + spinVel * dt) % 360;
          platter.style.transform = `rotate(${angle}deg)`;
        }

        updateArm(ts, dt);

        if (
          rm ||
          !audio.paused ||
          easing ||
          autoAdvancing ||
          armAnimating ||
          scrubbing ||
          Math.abs(armTargetDeg - armCurDeg) > 0.02
        ) {
          animFrame = requestAnimationFrame(animateSpin);
        } else {
          cancelRAF();
        }
      }

      (function warmArtPolitely(){
        const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        if (conn?.saveData) return;
        if (['slow-2g','2g','3g'].includes(conn?.effectiveType)) return;

        const urls = [...new Set(tracks.map(t => t.art).filter(Boolean))];

        const q = urls.slice();
        const CONCURRENCY = 3;
        let inflight = 0;

        function kick() {
          while (inflight < CONCURRENCY && q.length) {
            const u = q.shift();
            inflight++;
            (window.requestIdleCallback
              ? (fn) => requestIdleCallback(fn, { timeout: 2000 })
              : (fn) => setTimeout(fn, 0))(() => {
                const img = new Image();
                img.decoding = 'async';
                img.referrerPolicy = 'no-referrer';
                img.onload = img.onerror = () => {
                  inflight--;
                  kick();
                };
                img.src = u;
              });
          }
        }

        addEventListener('load', kick);
      })();

      function next(){
        const shouldAutoplay = !audio.paused;
        if (!shouldAutoplay) easeArmToDeg(ARM_REST, ARM_EASE_FAST);

        if (shuffle && shuffleOrder) {
          shuffleCursor = (shuffleCursor + 1) % shuffleOrder.length;
          i = shuffleOrder[shuffleCursor];
          load(i, shouldAutoplay);
          renderPlaylist();
          return;
        }

        i = (i + 1) % tracks.length;
        load(i, shouldAutoplay);
        renderPlaylist();
      }

      function prev(){
        const shouldAutoplay = !audio.paused;
        if (!shouldAutoplay) easeArmToDeg(ARM_REST, ARM_EASE_FAST);

        if (shuffle && shuffleOrder) {
          shuffleCursor = (shuffleCursor - 1 + shuffleOrder.length) % shuffleOrder.length;
          i = shuffleOrder[shuffleCursor];
          load(i, shouldAutoplay);
          renderPlaylist();
          return;
        }

        i = (i - 1 + tracks.length) % tracks.length;
        load(i, shouldAutoplay);
        renderPlaylist();
      }

      function load(index, autoplay=false){
        if (pendingResume && pendingResume.idx !== index) pendingResume = null;

        if (!autoplay) {
          prePlaySeekP = null;

          autoAdvancing = false;
          scrubbing = false;
          easeArmToDeg(ARM_REST, ARM_EASE_FAST);
          ensureRAF();
        }

        i = index;
        setSource(tracks[i]);
        setRate(rate);

        if (autoplay) {
          easeArmToDeg(progToDeg(0), ARM_EASE_FAST);
          audio.currentTime = 0;
          audio.play().then(()=>{ startSpin(); playBtn.textContent = '‚ùö‚ùö pause'; }).catch(()=>{});
        } else {
          autoAdvancing = false;
          scrubbing = false;

          stopImmediate();
          resetPlatterAngle();

          easeArmToDeg(ARM_REST, ARM_EASE_FAST);
          ensureRAF();

          playBtn.textContent = '‚ñ∫ play';
        }
      }

      function formatTime(sec){
        if (!isFinite(sec)) return '--:--';
        const m = Math.floor(sec / 60);
        const s = Math.floor(sec % 60);
        return `${m}:${String(s).padStart(2,'0')}`;
      }

      function onLoaded(){
        const d = audio.duration;
        if (isFinite(d) && d > 0) {
          seek.max = d;
          seek.disabled = false;
          tDur.textContent = formatTime(d);
          if (!audio.paused && !scrubbing){
            setArmByProgress((audio.currentTime || 0) / d);
          }
        } else {
          seek.max = 0;
          seek.disabled = true;
          tDur.textContent = '--:--';
          if (!audio.paused) setArmByProgress(0);
        }
        if (!seekDragging) tCur.textContent = formatTime(audio.currentTime || 0);
      }

      function onTimeUpdate(){
        if (seekDragging) return;
        const cur = audio.currentTime || 0;
        const d = audio.duration;
        seek.value = cur;
        tCur.textContent = formatTime(cur);
        if (isFinite(d) && d > 0) setArmByProgress(cur/d);
        savePlaybackState(false);
      }

      function ensureLoadFlag(){
        let f = document.getElementById('loadflag');
        if(!f){
          f = document.createElement('span');
          f.id = 'loadflag';
          f.className = 'loadflag';
          f.textContent = '(loading)';
          meta.appendChild(f);
        }
        return f;
      }
      function setLoading(on){
        ensureLoadFlag().classList.toggle('hidden', !on);
      }

      function savePlaybackState(force=false){
        const now = performance.now();
        if (!force && (now - lastStateSave) < STATE_SAVE_INTERVAL) return;
        lastStateSave = now;

        try {
          const payload = {
            idx: i,
            src: tracks[i]?.src || '',
            pos: Math.max(0, Math.floor(audio.currentTime || 0)),
            rate,
            repeatMode,
            shuffle: !!shuffle,
            fingerprint: tracks.map(t => (t?.title||'') + '|' + (t?.artist||'')),
            ts: Date.now()
          };
          sessionStorage.setItem(PLAYBACK_KEY, JSON.stringify(payload));
        } catch {}
      }

      function tryRestorePlaybackState(){
        try {
          const raw = sessionStorage.getItem(PLAYBACK_KEY);
          if (!raw) return false;
          const data = JSON.parse(raw);

          if (!Array.isArray(data.fingerprint) || data.fingerprint.length !== tracks.length) {
            return false;
          }

          let idx = typeof data.idx === 'number' ? data.idx : 0;
          if (tracks[idx]?.src !== data.src) {
            idx = tracks.findIndex(t =>
              t.src === data.src ||
              ((t.title||'') + '|' + (t.artist||'')) === data.fingerprint[data.idx]
            );
            if (idx < 0) idx = 0;
          }

          i = idx;
          setSource(tracks[i]);
          setRate(typeof data.rate === 'number' ? data.rate : rate);
          repeatMode = data.repeatMode || 'off';
          syncRepeatUI(document.getElementById('repeat'));

          const targetPos = Number(data.pos) || 0;
          pendingResume = { idx, pos: targetPos };

          const onMeta = () => {
            if (pendingResume && i === pendingResume.idx) {
              const d = audio.duration;
              const p = Math.min(Math.max(0, pendingResume.pos), isFinite(d) ? Math.max(0, d - 0.01) : pendingResume.pos);
              audio.currentTime = p;
              seek.value = p;
              tCur.textContent = formatTime(p);
            }
            pendingResume = null;
            audio.removeEventListener('loadedmetadata', onMeta);
          };
          audio.addEventListener('loadedmetadata', onMeta);

          renderPlaylist?.();
          highlightPlaylist(i);

          return true;
        } catch {
          return false;
        }
      }

      addEventListener('beforeunload', () => {
        savePlaybackState(true);
      });

      playBtn.addEventListener('click', playPause);
      prevBtn.addEventListener('click', prev);
      nextBtn.addEventListener('click', next);
      repeatBtn.addEventListener('click', cycleRepeat);

      shuffleBtn.addEventListener('click', () => {
        shuffle = !shuffle;
        shuffleBtn.setAttribute('aria-pressed', String(shuffle));
        shuffleBtn.textContent = shuffle ? 'shuffle (on)' : 'shuffle';

        if (shuffle) {
          shuffleOrder  = buildShuffleOrder(i);
          shuffleCursor = 0;
        } else {
          shuffleOrder  = null;
          shuffleCursor = 0;
        }

        renderPlaylist();
      });

      pitchBtn.addEventListener('click', () => {
        const on = pitchBtn.getAttribute('aria-pressed') === 'true';
        pitchBtn.setAttribute('aria-pressed', String(!on));
        pitchBtn.textContent = !on ? 'preserve pitch (on)' : 'preserve pitch';
        setPreservePitch(!on);
      });

      speed.addEventListener('input', (e) => setRate(e.target.value));
      speed.addEventListener('change', () => speed.blur());

      (function enableSpeedReset(){
        if (!speedVal) return;
        speedVal.title = 'click to reset speed to 1.00√ó';
        speedVal.tabIndex = 0;

        function resetSpeed(){
          setRate(1);
          speedVal.animate?.([{opacity: .6},{opacity: 1}], {duration: 180, easing: 'ease-out'});
        }

        speedVal.addEventListener('click', resetSpeed);
        speedVal.addEventListener('keydown', (e)=>{
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); resetSpeed(); }
        });
      })();

      seek.addEventListener('pointerdown', () => {
        seekDragging = true;
        scrubbing = true;
        ensureRAF();
      });

      seek.addEventListener('input', (e) => {
        const v = Number(e.target.value);
        tCur.textContent = formatTime(v);

        const d = (isFinite(audio.duration) && audio.duration > 0)
          ? audio.duration
          : (isFinite(seek.max) ? Number(seek.max) : 0);

        if (d > 0){
          const p = v / d;

          if (scrubbing) {
            setArmByProgress(p);
          } else {
            easeArmToDeg(progToDeg(p), ARM_EASE_SEEK);
          }
        }

        ensureRAF();
      });

      seek.addEventListener('pointerup', () => {
        const v = Number(seek.value);
        audio.currentTime = isFinite(v) ? v : 0;
        seekDragging = false;
        scrubbing = false;

        const d = (isFinite(audio.duration) && audio.duration > 0) ? audio.duration : 0;
        if (d > 0) easeArmToDeg(progToDeg((audio.currentTime || 0) / d), ARM_EASE_SEEK);

        seek.blur();
      });

      seek.addEventListener('change', (e) => {
        const v = Number(e.target.value);
        audio.currentTime = isFinite(v) ? v : 0;
        seekDragging = false;
        scrubbing = false;
        const d = (isFinite(audio.duration) && audio.duration > 0) ? audio.duration : 0;
        if (d > 0) easeArmToDeg(progToDeg((audio.currentTime || 0) / d), ARM_EASE_SEEK);
      });

      audio.addEventListener('loadedmetadata', onLoaded);
      audio.addEventListener('durationchange', onLoaded);
      audio.addEventListener('timeupdate', onTimeUpdate);

      audio.addEventListener('pause', () => {
        if (audio.ended || autoAdvancing) return;
        startEaseOut();
        savePlaybackState(true);
      });

      audio.addEventListener('ended', () => {
        seek.value = seek.max || 0;

        if (repeatMode === 'one') { audio.currentTime = 0; audio.play().catch(()=>{}); return; }

        if (shuffle && shuffleOrder) {
          const atLast = shuffleCursor >= shuffleOrder.length - 1;

          if (!atLast) {
            autoAdvancing = true;
            ensureRAF();
            shuffleCursor += 1;
            i = shuffleOrder[shuffleCursor];
            load(i, true);
            renderPlaylist();
            return;
          }

          if (repeatMode === 'all') {
            autoAdvancing = true;
            ensureRAF();
            shuffleCursor = 0;
            i = shuffleOrder[0];
            load(i, true);
            renderPlaylist();
            return;
          }

          startEaseOut();
          playBtn.textContent = '‚ñ∫ play';
          turntable.classList.remove('playing');
          return;
        }

        const atLast = i >= tracks.length - 1;

        if (!atLast) {
          autoAdvancing = true;
          ensureRAF();
          i = i + 1;
          load(i, true);
          renderPlaylist();
          return;
        }

        if (repeatMode === 'all') {
          autoAdvancing = true;
          ensureRAF();
          i = 0;
          load(i, true);
          renderPlaylist();
          return;
        }

        startEaseOut();
        playBtn.textContent = '‚ñ∫ play';
        turntable.classList.remove('playing');
      });

      function updateArm(ts, dt){
        if (!armEl) return;

        const d = audio.duration;
        if (!audio.paused && !scrubbing && isFinite(d) && d > 0){
          armTargetDeg = progToDeg((audio.currentTime || 0) / d);
        }

        let nextDeg = armCurDeg;
        if (armAnimating){
          const t = Math.min(1, (ts - armEaseStart) / armEaseDur);
          const eased = 1 - Math.pow(1 - t, 3);
          const dtc = Math.min(dt, 1/30);
          const alpha = Math.min(1, dtc * ARM_FOLLOW_HZ);
          nextDeg = armCurDeg + (armTargetDeg - armCurDeg) * alpha;
          if (t >= 1) armAnimating = false;
        } else {
          const alpha = Math.min(1, dt * ARM_FOLLOW_HZ);
          nextDeg = armCurDeg + (armTargetDeg - armCurDeg) * alpha;
        }

        if (Math.abs(nextDeg - armCurDeg) > 0.001){
          armCurDeg = nextDeg;
          armEl.style.transform = `rotate(${ARM_BASE_DEG + armCurDeg}deg)`;
        }
      }

      audio.addEventListener('waiting', () => { if(!audio.paused) setLoading(true); });
      audio.addEventListener('stalled', () => { if(!audio.paused) setLoading(true); });
      audio.addEventListener('error',  () => setLoading(false));
      audio.addEventListener('playing', () => {
        setLoading(false);
        const t = tracks[i];
        document.title = `${t.title} ‚Äì ${t.artist} | ${defaultTitle}`;

        const d = audio.duration;
        const cur = audio.currentTime || 0;
        if (isFinite(d) && d > 0) {
          easeArmToDeg(progToDeg(cur/d), ARM_EASE_FAST);
        }
      });

      if (volume) {
        const savedV = localStorage.getItem(VOL_KEY);
        const savedM = sessionStorage.getItem(MUTE_KEY) === '1';
        setVolume(savedV != null ? savedV : 1);
        setMuted(savedM);

        volume.addEventListener('input', (e)=>{
          setMuted(false);
          setVolume(e.target.value);
        });

        volume.addEventListener('change', () => volume.blur());
      }

      const SEEK_SMALL = 5, SEEK_BIG = 10
      function clamp(n, lo, hi){return Math.min(hi, Math.max(lo, n))}
      function seekBy(sec){
        if(!isFinite(audio.duration)) return;
        audio.currentTime = clamp((audio.currentTime||0)+sec, 0, audio.duration);
        if (audio.paused) { easeArmToDeg(progToDeg((audio.currentTime||0)/audio.duration), ARM_EASE_SEEK); ensureRAF(); }
      }

      function jumpToPercent(p){
        if(!isFinite(audio.duration)) return;
        audio.currentTime = audio.duration*clamp(p,0,1);
        if (audio.paused) { easeArmToDeg(progToDeg((audio.currentTime||0)/audio.duration), ARM_EASE_SEEK); ensureRAF(); }
      }

      document.addEventListener('keydown', e => {
        const el = e.target
        const tag = (el.tagName||'').toUpperCase()
        const type = (el.type||'').toLowerCase()
        const isTypingField =
          tag==='TEXTAREA' ||
          (tag==='INPUT' && /^(text|search|email|number|password|url|tel|date|time|datetime-local|month|week)$/i.test(type)) ||
          el.isContentEditable;
        if (isTypingField || e.altKey || e.ctrlKey || e.metaKey) return

        const s = e.shiftKey
        switch (e.code) {
          case 'KeyK': case 'Space': e.preventDefault(); playPause(); break
          case 'ArrowRight': e.preventDefault(); seekBy(s?SEEK_BIG:SEEK_SMALL); break
          case 'ArrowLeft':  e.preventDefault(); seekBy(s?-SEEK_BIG:-SEEK_SMALL); break
          case 'KeyL': seekBy(SEEK_BIG); break
          case 'KeyJ': seekBy(-SEEK_BIG); break
          case 'Period': next(); break;
          case 'Comma':  prev(); break;
          case 'ArrowUp':   e.preventDefault(); bumpVolume(e.shiftKey ? 0.1 : 0.05); break
          case 'ArrowDown': e.preventDefault(); bumpVolume(e.shiftKey ? -0.1 : -0.05); break
          case 'KeyM': audio.muted = !audio.muted; setMuted(audio.muted); break
          case 'KeyS':
            e.preventDefault();
            shuffle = !shuffle;
            shuffleBtn.setAttribute('aria-pressed', String(shuffle));
            shuffleBtn.textContent = shuffle ? 'shuffle (on)' : 'shuffle';
            if (shuffle) {
              shuffleOrder  = buildShuffleOrder(i);
              shuffleCursor = shuffleOrder.indexOf(i);
            } else {
              shuffleOrder  = null;
              shuffleCursor = 0;
            }
            renderPlaylist();
            break;
          case 'KeyR': cycleRepeat(); break
          case 'Home': e.preventDefault(); jumpToPercent(0); break
          case 'End':  e.preventDefault(); if (isFinite(audio.duration)) audio.currentTime = Math.max(0, audio.duration - .01); break
          case 'Digit0': case 'Digit1': case 'Digit2': case 'Digit3': case 'Digit4':
          case 'Digit5': case 'Digit6': case 'Digit7': case 'Digit8': case 'Digit9':
            jumpToPercent(Number(e.code.slice(-1)) / 10); break
        }
      })

      if('mediaSession'in navigator){
        const updateMeta=()=>{const t=tracks[i]||{};try{navigator.mediaSession.metadata=new MediaMetadata({title:t.title||'',artist:t.artist||'',album:"bevvy's vinyl",artwork:t.art?[{src:t.art,sizes:'512x512',type:'image/webp'}]:[]})}catch{}}
        const _loadMS=load;load=(idx,a=false)=>{_loadMS(idx,a);updateMeta();highlightPlaylist(idx)}
        navigator.mediaSession.setActionHandler('play',()=>{if(audio.paused)playPause()})
        navigator.mediaSession.setActionHandler('pause',()=>{if(!audio.paused)playPause()})
        navigator.mediaSession.setActionHandler('stop',()=>{if(!audio.paused)playPause()})
        navigator.mediaSession.setActionHandler('previoustrack',prev)
        navigator.mediaSession.setActionHandler('nexttrack',next)
        navigator.mediaSession.setActionHandler('seekbackward',d=>seekBy(-(d?.seekOffset||SEEK_SMALL)))
        navigator.mediaSession.setActionHandler('seekforward',d=>seekBy(d?.seekOffset||SEEK_SMALL))
        navigator.mediaSession.setActionHandler('seekto',d=>{if(d.fastSeek&&'fastSeek'in audio)audio.fastSeek(d.seekTime);else audio.currentTime=d.seekTime})
      }

      const aboutData = {
        text: "i bevvy, ergo, i am. welcome to my site! i'm from the USA, and i was raised on Homestuck and FNAF. i like computers, and i enjoy making user-friendly foss programs. sometimes i do art, but good luck finding it!<br>the music you see above is a selection of songs that are meaningful to me for one reason or another, and i hope you enjoy them.",
        tags: [
          "pronouns: any/it ‚ö£",
          "intp-5w4",
          "arch btw",
          "masto: @bevvy@trollian.space",
          "signal: bevvy.04",
          "github: calibancode"
        ]
      };

      const favImages = [
        { src: FAV("rat-pizza.gif"), alt: "an animated rat feeding you pizza" },
        { src: FAV("my-summer-car-120.webp"), full: FAV("my-summer-car.webp"), alt: "a gif from my summer car of the player drinking beer and throwing the bottle at teimo" },
        { src: FAV("sad-imp.webp"), alt: "a sad looking imp in a fashionable wizard hat from homestuck" },
        { src: FAV("nightmare-blunt-rotation.webp"), alt: "hideo kojima smoking a fat dart" },
        { src: FAV("shady-sam.webp"), alt: "shady sam from oblivion with a massive red arrow pointing at his face" },
        { src: FAV("gucci-store.webp"), alt: "bladee buyin the gucci store its like breaching air its nothing it means nothing" },
        { src: FAV("nikola-einstein.webp"), alt: "charicatures of nikola and einstein" },
        { src: FAV("stolas-warzone.jpg"), alt: "now that you're gone stolas in the style of a shellshocked soldier" },
        { src: FAV("furry-abuse.jpg"), alt: "a classic furry meme depicting domestic abuse" },
        { src: FAV("shrek-avatar.jpg"), alt: "an unholy abomination depicting shrek as a na'vi from james cameron's avatar" },
        { src: FAV("wizard.webp"), alt: "an extremely powerful wizard" },
        { src: FAV("crusher-unicycle.jpg"), alt: "dr beverly crusher riding a motorcycle behind the scenes of star trek tng" },
        { src: FAV("mugshot.webp"), alt: "a baby spotted hyena looking faintly ridiculous" },
        { src: FAV("mood.jpg"), alt: "mituna captor and cronus ampora having a moment" },
        { src: FAV("car.png"), alt: "car from garn47 with soulless, dead eyes" },
        { src: FAV("timon.webp"), alt: "timon from the lion king with an unimpressed expression" }
      ];

      function renderAbout(){
        const p = document.getElementById('about-text');
        const tagsWrap = document.getElementById('about-tags');
        if (p) p.innerHTML = aboutData.text;
        if (tagsWrap) {
          tagsWrap.innerHTML = '';
          (aboutData.tags || []).forEach(t => {
            const span = document.createElement('span');
            span.textContent = t;
            tagsWrap.appendChild(span);
          });
        }
      }

      function renderFavs(){
        const wrap = document.getElementById('fav-gallery');
        const sec  = document.getElementById('favorites');
        if (!wrap || !sec) return;

        // don‚Äôt mount twice
        if (renderFavs._mounted) return;

        // wait until the hero art has painted once, then allow the gallery to start
        const startAfterHero = () => {
          if (renderFavs._mounted) return;

          const mount = () => {
            if (renderFavs._mounted) return;
            renderFavs._mounted = true;

            wrap.innerHTML = '';
            let idx = 0;
            const batchSize = 6;

            function addBatch(){
              const end = Math.min(idx + batchSize, favImages.length);
              for (; idx < end; idx++) {
                const item = favImages[idx];

                let src  = item.src;
                let full = item.full ?? item.dataFull ?? item['data-full'] ?? null;
                let alt  = item.alt || '';

                if (altLayout) {
                  src  = FAV("scooter.webp");
                  full = FAV("scooter.webp");
                  alt  = "a scooter";
                }

                const img = document.createElement('img');
                img.loading = 'lazy';
                img.decoding = 'async';
                img.setAttribute('fetchpriority','low');
                img.src = src;
                img.alt = alt;

                const a = document.createElement('a');
                a.href = full || src;
                a.target = '_blank';
                a.rel = 'noopener';
                a.appendChild(img);

                wrap.appendChild(a);
              }

              if (idx < favImages.length) {
                (window.requestIdleCallback ? requestIdleCallback : (fn)=>setTimeout(fn,0))(addBatch, { timeout: 1500 });
              }
            }

            addBatch();
          };

          // if already visible, mount now; else wait until scrolled near
          const rect = sec.getBoundingClientRect();
          const inView = rect.top < (window.innerHeight || 0) && rect.bottom > 0;
          if (inView) {
            mount();
          } else {
            const io = new IntersectionObserver((entries) => {
              if (entries.some(e => e.isIntersecting)) {
                mount();
                io.disconnect();
              }
            }, { rootMargin: '200px' });
            io.observe(sec);
          }
        };

        if (art?.complete) {
          // image already loaded from cache/network
          startAfterHero();
        } else {
          art?.addEventListener?.('load', startAfterHero, { once: true });
        }
      }

      function renderPlaylist(){
        const wrap = document.getElementById('playlist-list');
        if(!wrap) return;
        wrap.innerHTML = '';

        const order = getVisibleOrder();

        order.forEach((trackIdx) => {
          const t = tracks[trackIdx];
          const b = document.createElement('button');
          b.type = 'button';
          b.setAttribute('data-idx', trackIdx);
          b.innerHTML = `<strong>${t.title}</strong><br><span class="artist">${t.artist}</span>`;
          if (trackIdx === i) b.setAttribute('aria-current','true');

          b.addEventListener('click', ()=>{
            autoAdvancing = false;
            const shouldAutoplay = autoAdvancing || !audio.paused;

            if (shuffle && shuffleOrder) {
              const pos = shuffleOrder.indexOf(trackIdx);
              if (pos !== -1) shuffleCursor = pos;
            }

            if (!shouldAutoplay) {
              easeArmToDeg(ARM_REST, ARM_EASE_FAST);
            }

            i = trackIdx;
            load(i, shouldAutoplay);
            renderPlaylist();
          });

          wrap.appendChild(b);
        });
      }

      function highlightPlaylist(idx){
        const wrap = document.getElementById('playlist-list');
        if(!wrap) return;
        [...wrap.querySelectorAll('button')].forEach(x=>x.removeAttribute('aria-current'));
        wrap.querySelector(`button[data-idx="${idx}"]`)?.setAttribute('aria-current','true');
      }

      function syncStageH(){
        const stage = document.querySelector('.stage');
        const deck  = document.querySelector('.deck');
        if(!stage || !deck) return;

        const h = Math.round(stage.getBoundingClientRect().height);
        deck.style.setProperty('--stageH', h + 'px');

        const sumPL = document.querySelector('#playlist summary');
        const list  = document.querySelector('#playlist .plist');
        if (list && sumPL) {
          const head = Math.round(sumPL.getBoundingClientRect().height);
          list.style.maxHeight = (h - head - 24) + 'px';
        }

        const sumN = document.querySelector('#notes summary');
        const pad  = document.getElementById('notepad');
        if (pad && sumN) {
          const headN = Math.round(sumN.getBoundingClientRect().height);
          pad.style.height = (h - headN - 24) + 'px';
        }
      }

      addEventListener('load', syncStageH);
      addEventListener('resize', syncStageH);
      document.getElementById('art')?.addEventListener('load', syncStageH);
      syncStageH();
      syncRepeatUI();

      const NOTES_KEY='vinyl_notes_v1';
      const noteEl=document.getElementById('notepad');
      if(noteEl){
        noteEl.value = localStorage.getItem(NOTES_KEY) || '';
        noteEl.addEventListener('input', ()=> localStorage.setItem(NOTES_KEY, noteEl.value));
      }

      document.getElementById('pld')?.addEventListener('toggle', syncStageH);
      document.getElementById('noted')?.addEventListener('toggle', syncStageH);

      if (matchMedia('(max-width:900px)').matches) {
        document.getElementById('pld')?.removeAttribute('open');
        document.getElementById('noted')?.removeAttribute('open');
      }

      (function enableArmDragIntegrated(){
        const svg   = document.querySelector('.tonearm');
        const arm   = document.getElementById('arm');
        const audio = document.getElementById('audio');
        const seek  = document.getElementById('seek');
        const tCur  = document.getElementById('tCur');
        const playBtn   = document.getElementById('play');
        const turntable = document.getElementById('turntable');

        if (!svg || !arm || !audio || !seek || !tCur) { addEventListener('load', enableArmDragIntegrated, { once:true }); return; }

        arm.style.pointerEvents = 'auto';
        arm.style.cursor = 'grab';
        arm.style.touchAction = 'none';

        const pivot = { x: 180, y: 20 };
        function clamp(n, lo, hi){ return Math.min(hi, Math.max(lo, n)); }
        function clientToSvg(el, cx, cy){
          const pt = el.createSVGPoint(); pt.x = cx; pt.y = cy;
          const m = el.getScreenCTM(); return m ? pt.matrixTransform(m.inverse()) : { x: cx, y: cy };
        }
        const wrap180 = a => ((a + 180) % 360 + 360) % 360 - 180;
        function angleFromPointerRaw(ev){
          const p = clientToSvg(svg, ev.clientX, ev.clientY);
          return Math.atan2(p.y - pivot.y, p.x - pivot.x) * 180 / Math.PI;
        }
        function normalize360(a){ return (a % 360 + 360) % 360; }
        function angleFromPointer(ev){
          const p = clientToSvg(svg, ev.clientX, ev.clientY);
          const raw = Math.atan2(p.y - pivot.y, p.x - pivot.x) * 180 / Math.PI;
          const armSpace = normalize360(raw - ARM_BASE_DEG);
          return clamp(armSpace, ARM_REST, ARM_MAX);
        }
        function degToProg(deg){
          return GEO.degToPGeom(deg);
        }
        function formatTimeLocal(sec){
          if (!isFinite(sec)) return '--:--';
          const m = Math.floor(sec/60), s = Math.floor(sec%60);
          return `${m}:${String(s).padStart(2,'0')}`;
        }

        let dragging = false;
        let wasPlaying = false;
        let dragAngle = 0;
        let lastRaw = 0;

        function syncByDeg(deg){
          armAnimating = false;
          armCurDeg    = deg;
          armTargetDeg = deg;
          arm.style.transform = `rotate(${ARM_BASE_DEG + deg}deg)`;

          if (isOnPlatterDeg(deg) && isFinite(audio.duration) && audio.duration > 0){
            const p = degToProg(deg);
            const t = audio.duration * p;
            seek.value = t;
            tCur.textContent = formatTimeLocal(t);
          }
        }

        function onPointerDown(ev){
          dragging = true;
          wasPlaying = !audio.paused;

          scrubbing    = true;
          seekDragging = true;

          if (wasPlaying) {
            autoAdvancing = true;
            turntable.classList.add('playing');
            audio.pause();
          } else {
            autoAdvancing = false;
            turntable.classList.remove('playing');
          }

          ensureRAF();

          arm.style.cursor = 'grabbing';
          arm.setPointerCapture?.(ev.pointerId);

          lastRaw   = angleFromPointerRaw(ev);
          dragAngle = armCurDeg;
          ev.preventDefault();
        }

        function onPointerMove(ev){
          if (!dragging) return;

          const raw = angleFromPointerRaw(ev);
          const d   = wrap180(raw - lastRaw);
          lastRaw   = raw;

          dragAngle = clamp(dragAngle + d, ARM_REST, ARM_MAX);
          syncByDeg(dragAngle);

          ev.preventDefault();
        }

        function onPointerUp(ev){
          if (!dragging) return;
          dragging = false;

          const onPlatter = isOnPlatterDeg(dragAngle);
          const hasMeta   = isFinite(audio.duration) && audio.duration > 0;

          if (onPlatter){
            const p = degToProg(dragAngle);
            if (hasMeta){
              const t = Math.min(audio.duration - 0.01, audio.duration * p);
              audio.currentTime = t; seek.value = t; tCur.textContent = formatTime(t);
              prePlaySeekP = null;
            } else {
              prePlaySeekP = p;
            }
          } else {
            prePlaySeekP = null;
            if (hasMeta){ audio.currentTime = 0; seek.value = 0; tCur.textContent = '0:00'; }
          }

          seekDragging = false;
          scrubbing    = false;

          if (wasPlaying){
            autoAdvancing = false;
            audio.play().then(()=>{
              startSpin();
              playBtn.textContent = '‚ùö‚ùö pause';
              const d = audio.duration;
              if (isFinite(d) && d > 0){
                easeArmToDeg(progToDeg((audio.currentTime||0)/d), ARM_EASE_FAST);
              }
            }).catch(()=>{});
          } else {
            autoAdvancing = false;
            turntable.classList.remove('playing');
            easeArmToDeg(dragAngle, ARM_EASE_FAST);
          }

          arm.style.cursor = 'grab';
          arm.releasePointerCapture?.(ev.pointerId);
          ev.preventDefault();
        }

        arm.addEventListener('pointerdown', onPointerDown);
        window.addEventListener('pointermove', onPointerMove, { passive: false });
        window.addEventListener('pointerup',   onPointerUp,   { passive: false });
        window.addEventListener('pointercancel', onPointerUp, { passive: false });
        arm.addEventListener('lostpointercapture', onPointerUp);

        window.addEventListener('blur', () => { if (dragging) onPointerUp(new Event('pointercancel')); });
        document.addEventListener('visibilitychange', () => {
          if (document.hidden && dragging) onPointerUp(new Event('pointercancel'));
        });
      })();

      (()=>{let p=0,m=Array.from(atob('Nzc5OTQ2NDZTUA=='),c=>c.charCodeAt(0)^17);addEventListener('keydown',e=>{p=e.keyCode===m[p]?p+1:0;if(p===m.length){p=0;altLayout=true;alert('scooter mode enabled!');swapArt(tracks[i].art);delete renderFavs._mounted;document.getElementById('fav-gallery').innerHTML='';renderFavs();}});})();

      (function mountReducedMotionOverride(){
        if (!reducesMotion()) return;

        const row = document.querySelector('.buttons-row');
        if (!row) return;

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.id   = 'rm-override';
        btn.textContent = 'enable animations';
        btn.title = 'Override ‚ÄúReduce Motion‚Äù for this session';
        row.appendChild(btn);

        btn.addEventListener('click', () => {
          sessionStorage.setItem(RM_OVERRIDE_KEY, 'force-off');

          ensureRAF();
          if (!audio.paused) {
            spinVel = currentDegPerSec();
            turntable.classList.add('playing');
          }
          btn.remove();
        });
      })();

      renderAbout();
      renderFavs();
      buildSlugIndex();
      setArmImmediateDeg(ARM_REST);
      renderPlaylist();
      highlightPlaylist(i);
      setPreservePitch(false);

      if (tracks.length) {
        if (!consumeTrackParam()) {
          const restored = tryRestorePlaybackState?.();
          if (!restored) load(0, false);
        }
      } else {
        meta.textContent = 'drop some tracks into the tracks[] array.';
      }
    })();
  </script>
  <img src="https://bevvy.goatcounter.com/count?p=/" style="position: absolute; opacity:0;">
</body>
  <!--
      this page was designed by bevvy
      and coded by ozzie.
      (if you're reading this, you're cute.)
  -->
</html>
